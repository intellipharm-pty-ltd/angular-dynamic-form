/*!
 * angular-dynamic-form v0.3.0
 * http://intellipharm.com/
 *
 * Copyright 2015 Intellipharm
 *
 * 2015-06-11 08:14:04
 *
 */
!function(){"use strict";angular.module("AngularDynamicForm",["angular.filter"])}(),function(){"use strict";var a="AngularDynamicForm: ";angular.module("AngularDynamicForm").value("AngularDynamicFormCustomInputViewUrl","views/inputs/").constant("DYNAMIC_FORM_EVENTS",{init:"dynamic-form:init",valid:"dynamic-form:valid",invalid:"dynamic-form:invalid",saveSuccess:"dynamic-form:process-success",saveError:"dynamic-form:process-error",submit:"dynamic-form:submit",validate:"dynamic-form:validate"}).constant("MESSAGE_EXTERNAL_METHOD_ERROR",a+"Custom method must handle its own errors").constant("MESSAGE_EXTERNAL_METHOD_INVALID_RETURN",a+"Custom method must return either Boolean value or Promise").constant("MESSAGE_INVALID_STEP",a+"Invalid step").constant("MESSAGE_UNRECOGNISED_STEP_NAME",a+"Unrecognised step name").constant("MESSAGE_INVALID_CONFIG",a+"Invalid config").constant("MESSAGE_INVALID_FIELDS_OBJECT",a+"Invalid fields object").constant("MESSAGE_INVALID_OPTIONS_ARRAY",a+"Invalid options array").constant("MESSAGE_INVALID_OPTIONS_OBJECT",a+"Invalid options object").constant("MESSAGE_UNRECOGNISED_CONFIG_NAME",a+"Unrecognised config name").constant("MESSAGE_INVALID_MODEL_METHOD",a+"Invalid model method")}(),function(){"use strict";var a=function(a,b,c,d,e,f,g){var h=this;b.is_submitting=b.form_config.auto_submit,b.submit_step=null,b.show_buttons=b.is_submitting;var i=["model"];this.default_submit_steps=["validate","save"],b.message={},b.message_state={success:!1,error:!1},this.onCancel=function(){_.isUndefined(b.onCancel)||b.onCancel("")},this.onClear=function(){_.forEach(b.model,function(a,c){_.contains(i,c)||(b.model[c]=void 0)},this),_.isUndefined(b.onClear)||b.onClear("")},this.onFieldBlur=function(){_.isUndefined(b.onBlur)||b.onBlur()},this.onFieldChange=function(){_.isUndefined(b.onChange)||b.onChange({model:b.model}),b.form_config.show_buttons_on_change&&(b.show_buttons=!0)},this.onSubmit=function(){var a=_.isUndefined(b.submit_steps)?this.default_submit_steps:b.submit_steps;b.is_submitting=!0,g.handleSubmit(a,b.model,b.form_config).then(function(a){_.isUndefined(b.onSubmitComplete)||b.onSubmitComplete(a),b.is_submitting=!1},function(a){_.isUndefined(b.onError)||b.onError(a)},function(a){switch(b.errors=a.data,_.isUndefined(a.message)||h.showMessage(a.message_state,a.message),a.step){case"validate":"success"===a.message_state?b.$emit(d.valid,a):b.$emit(d.invalid,a);break;case"save":"success"===a.message_state?b.$emit(d.saveSucccess,a):b.$emit(d.saveError,a)}})},this.init=function(){b.form_config=f.transformConfig("form",b.form_config),b.form_style_config=f.transformConfig("form_style",b.form_style_config),b.form_field_config=f.transformConfig("form_field",b.form_field_config),b.fields_array=e.transformFields(b.fields,b.form_config,b.model),b.has_groups&&(b.grouped_fields_array=e.transformGroupFields(b.fields_array,b.groups_config)),b.form_config.auto_submit&&(b.form_config.auto_submit=!1,this.onSubmit()),b.form_config.show_buttons_on_change||(b.show_buttons=!0)},this.hideMessage=function(){b.message={},_.forEach(b.message_state,function(a){a=!1})},this.showMessage=function(a,c){this.hideMessage(),b.message[a]=c,b.message_state[a]=!0};var j=null,k=null;b.$watch("model",function(a){_.isUndefined(a)||(h.init(),_.isNull(j)&&(j=b.$watch("fields",function(a){_.isUndefined(a)||h.init()},!0)),_.isNull(k)&&(k=b.$watch("groups_config",function(a){_.isUndefined(a)||h.init()},!0)))},!0),b.$on(d.submit,function(a,c){_.has(c,"model")&&c.model!==b.model.model||h.onSubmit()})};a.$inject=["$rootScope","$scope","$q","DYNAMIC_FORM_EVENTS","AngularDynamicForm.transformers.FieldTransformer","AngularDynamicForm.transformers.ConfigTransformer","AngularDynamicForm.helpers.SubmitService"],angular.module("AngularDynamicForm").controller("DynamicFormCtrl",a)}(),function(){"use strict";var a=function(){return{restrict:"E",scope:{model:"=",fields:"=",form_config:"=config",form_field_config:"=fieldConfig",form_style_config:"=styleConfig",groups_config:"=groupsConfig",submit_steps:"=submitSteps",onSubmitComplete:"&",onCancel:"&",onClear:"&",onError:"&",onChange:"&",onBlur:"&"},controller:"DynamicFormCtrl as ctrl",templateUrl:"angular-dynamic-form/views/dynamic-form.html",link:function(a,b){b.addClass("dynamic-form"),_.isUndefined(a.groups_config)?(a.has_groups=!1,a.form_view_template="angular-dynamic-form/views/dynamic-form-no-groups.html"):(a.has_groups=!0,a.form_view_template="angular-dynamic-form/views/dynamic-form-groups.html")}}};a.$inject=[],angular.module("AngularDynamicForm").directive("dynamicForm",a)}(),function(){"use strict";var a=function(a,b,c,d,e){var f,g,h=this;this.handleSubmit=function(b,c,d){var e=a.defer(),f={submit_complete:e.resolve,submit_update:e.notify,submit_error:e.reject};return h.handleSubmitSteps(0,b,c,d,f),e.promise},this.handleSubmitSteps=function(a,b,c,d,e,k){return a=_.isUndefined(a)?0:a,a>=b.length?void i(e,k):void h.handleSubmitStep(a,b,c,d).then(function(i){_.has(i,"model")&&(c=i.model),_.has(i,"form_config")&&(d=i.form_config),g=i,f="success",j("success",i,a,b,d,e),h.handleSubmitSteps(++a,b,c,d,e,i)},function(h){_.has(h,"model")&&(c=h.model),_.has(h,"form_config")&&(d=h.form_config),g=h,f="success",j("error",h,a,b,d,e),i(e,h)})};var i=function(a,b){_.isNull(a.submit_complete)||a.submit_complete(b)},j=function(a,b,c,d,e,f){_.isObject(b)||(b={message:b}),c=_.isFunction(d[c])?"custom":d[c];var g;switch(c){case"validate":g="validation_"+a+"_message";break;case"save":g="save_"+a+"_message";break;default:g="custom_"+a+"_message"}var h={message_state:a,step:c};h.message=_.isNull(e[g])?b.message:e[g],h.data=_.has(b,"data")?b.data:{},_.isNull(f.submit_update)||f.submit_update(h)};this.handleSubmitStep=function(b,e,i,j){return a(function(a,k){if(!_.isFunction(e[b])&&!_.isString(e[b]))throw new Error(d);if(_.isFunction(e[b])){var l;return _.isUndefined(g)||_.isNull(g)||(_.isString(g)&&(g={message:g}),l=g,l.type=f),void c.callExternalMethod(e[b],l).then(a,k)}h.handleSubmitStepInternalMethod(b,e,i,j).then(a,k)})},this.handleSubmitStepInternalMethod=function(a,b,c,d){var f=b[a];if(!_.has(h.internal_methods,f))throw new Error(e);switch(f){case"validate":return h.internal_methods.validate(c,d);case"save":return h.internal_methods.save(c);default:return h.internal_methods[f]()}},this.save=function(a){return c.callExternalMethod(a.save,[],a)},this.internal_methods={validate:b.validate,save:this.save}};a.$inject=["$q","AngularDynamicForm.validation.ValidationService","AngularDynamicForm.helpers.ExternalCallService","MESSAGE_INVALID_STEP","MESSAGE_UNRECOGNISED_STEP_NAME"],angular.module("AngularDynamicForm").service("AngularDynamicForm.helpers.SubmitService",a)}(),function(){"use strict";var a=function(a,b,c){this.callExternalMethod=function(d,e,f){return a(function(a,g){var h;try{h=_.isUndefined(f)?d(e):d.apply(f,e)}catch(i){throw console.log(i),new Error(b)}if(_.isUndefined(h))throw new Error(c);if(h===!1||h===!0)h?a(null):g(null);else try{h.then(a,g)}catch(i){throw i instanceof TypeError?new Error(c):(console.log(i),new Error(b))}})}};a.$inject=["$q","MESSAGE_EXTERNAL_METHOD_ERROR","MESSAGE_EXTERNAL_METHOD_INVALID_RETURN"],angular.module("AngularDynamicForm").service("AngularDynamicForm.helpers.ExternalCallService",a)}(),function(){"use strict";var a=function(a,b){this.validate=function(d,e){return a(function(a,f){var g=c(d,e);b.callExternalMethod(d.validate,[g],d).then(a,f)})};var c=function(a,b){var c=[];return _.isNull(b.validate_fields)?_.isNull(b.validate_fields_exclude)||_.forEach(a,function(a,d){_.include(b.validate_fields_exclude,d)||_.include(b.validate_fields,d)||c.push(d)}):c=b.validate_fields,c}};a.$inject=["$q","AngularDynamicForm.helpers.ExternalCallService"],angular.module("AngularDynamicForm").service("AngularDynamicForm.validation.ValidationService",a)}(),function(){"use strict";var a=function(a){var b={auto_submit:!1,label_camelcase:!0,label_replace_underscores:!0,show_buttons_on_change:!1,show_error_messages:!0,show_success_messages:!0,show_submit_button:!0,show_cancel_button:!1,show_clear_button:!1,submit_button_label:"SUBMIT",cancel_button_label:"CANCEL",clear_button_label:"CLEAR",validate_fields:null,validate_fields_exclude:null,validation_error_message:null,validation_success_message:null,save_error_message:null,save_success_message:null,custom_error_message:null,custom_success_message:null},c={has_messages:!0,has_groups:!0,show_labels:!0,show_right_labels:!0,has_validation_feedback:!0,has_required_indicator:!0},d={form_class:"",fieldset_class:"",label_class:"",right_label_class:"",input_box_class:"",input_class:"",validation_feedback_class:"",required_indicator_class:"",message_box_class:"",button_box_class:"",submit_button_class:"",cancel_button_class:"",clear_button_class:"",message_error_class:"",field_message_error_class:"",message_success_class:"",is_submitting_icon:""};this.config={form:b,form_field:c,form_style:d},this.transformConfig=function(b,c){if(!_.has(this.config,b))throw new Error(a);return _.merge(_.clone(this.config[b]),c)}};a.$inject=["MESSAGE_UNRECOGNISED_CONFIG_NAME"],angular.module("AngularDynamicForm").service("AngularDynamicForm.transformers.ConfigTransformer",a)}(),function(){"use strict";var a=function(a,b,c,d){var e=["label_camelcase","label_replace_underscores"],f=["type"],g=["label","value"],h={text:{type:"text",required:!1},textarea:{type:"textarea",required:!1},currency:{type:"currency",symbol:"$",required:!1},password:{type:"password",required:!1},checkbox:{type:"checkbox",required:!1},select:{type:"select",options:[],required:!1},multi_select:{type:"select",options:[],size:4,required:!1}};this.transformFields=function(c,d,g){var h=[];if(0!==_.difference(e,_.keys(d)).length)throw new Error(a);return _.forEach(c,function(a,c){if(0!==_.difference(f,_.keys(a)).length)throw new Error(b);var e=i(a,c,d,g[c]);h.push(e)}),h},this.transformGroupFields=function(a,b){var c=[];return _.forEach(a,function(a){var d=1;_.forEach(b,function(b){_.forEach(b.fields,function(e,f){if(e===a.name){var g=_.clone(a);g.group_label=b.label,_.has(b,"order")&&(d=b.order),g.group_order=d,g.order=f,c.push(g)}c=_.sortBy(c,"order")},this),d++},this)},this),c=_.sortBy(c,"group_order")};var i=function(a,b,e){var f={};if(_.has(h,a.type)){if(_.has(a,"options")){if(!_.isArray(a.options))throw new Error(c);_.forEach(a.options,function(a){if(0!==_.difference(g,_.keys(a)).length)throw new Error(d)})}var i=_.cloneDeep(h[a.type]);f=_.merge(i,a)}else f=_.clone(a);return _.has(f,"label")||(f.label=j(b,e.label_camelcase,e.label_replace_underscores)),f.name=b,f.model=_.has(a,"model")?a.model:null,f.validate=!1,f},j=function(a,b,c){return c&&(a=a.replace(/\_/g," ")),b&&(a=_.startCase(a)),a}};a.$inject=["MESSAGE_INVALID_CONFIG","MESSAGE_INVALID_FIELDS_OBJECT","MESSAGE_INVALID_OPTIONS_ARRAY","MESSAGE_INVALID_OPTIONS_OBJECT"],angular.module("AngularDynamicForm").service("AngularDynamicForm.transformers.FieldTransformer",a)}(),function(){"use strict";var a=function(a){this.onBlur=function(){_.isUndefined(a.onBlur)||a.onBlur()},this.onChange=function(){_.isUndefined(a.onChange)||a.onChange(),"map"===a.field.format&&"multi_select"===a.field.type&&_.forEach(a.field.options,function(b){_.set(a.model,b.value,_.indexOf(a.value,b.value)>=0)}),_.set(a.model,a.field.name,a.value)},"map"===a.field.format&&"multi_select"===a.field.type&&(a.value=[],_.forEach(a.field.options,function(b){a.model[b.value]&&a.value.push(b.value)}),_.set(a.model,a.field.name,a.value))};a.$inject=["$scope"],angular.module("AngularDynamicForm").controller("DynamicFormFieldsetCtrl",a)}(),function(){"use strict";var a=function(a,b){return{restrict:"E",scope:{field:"=",model:"=",errors:"=",show_validation:"=showValidation",config:"=",style_config:"=styleConfig",onChange:"&",onBlur:"&"},controller:"DynamicFormFieldsetCtrl as ctrl",replace:!0,link:function(c){c.value=_.pluck([c.model],c.field.name)[0],c.input_view_template="angular-dynamic-form/views/inputs/"+c.field.type+".html",_.isUndefined(a.get(c.input_view_template))&&(c.input_view_template=b+c.field.type+".html")},templateUrl:"angular-dynamic-form/views/dynamic-form-fieldset.html"}};a.$inject=["$templateCache","AngularDynamicFormCustomInputViewUrl"],angular.module("AngularDynamicForm").directive("dynamicFormFieldset",a)}();
//# sourceMappingURL=angular-dynamic-form.min.js.map